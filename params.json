{"name":"Cartboy","tagline":"Cartboy, the universal autorestarter","body":"# Cartboy, the universal restarter\r\n\r\n## What?\r\nCartboy is a python script that tries to be a more or less universal restarter for any sort of application.\r\n\r\nSurely there must be some better alternatives out there but I strongly believe that reinventing the wheel once in a while can't really hurt.\r\nApplications fail and sometimes crash, that is inevitable. Of course you should debug and resolve the issue but this is not always possible and sometimes the only solution is an \"autorestarter\".\r\nAnd this is exactly where cartboy comes in. Why choose cartboy?\r\nMain strengths:\r\n* extensive logging \r\n* easy to set up, you don't need to know python to use cartboy\r\n* very flexible, you can configure different actions for status checking and starting of applications easily\r\n\r\nConfiguration is held in /etc/cartboy. Currently this means just the \"/etc/cartboy/applications\" directory, but this will change in future.\r\n\r\nCartboy debian package also installs a cron script in /etc/cron.d/cartboy that executes cartboy.py once per minute by default.\r\n\r\nLog file is written to /var/log/cartboy.log and it is quite extensive by default, so you should probably set up some sort of log rotation (logrotate script is not included in the cartboy package at the moment).\r\n\r\n## Installation\r\n\r\n\tdpkg -i cartboy.deb\r\n\r\nyes, that is it\r\n\r\n\r\n## Configuration \r\n\r\nConfiguration files live in /etc/cartboy and individual applications are defined in /etc/cartboy/applications, \r\neach application directory has to contain 2 scripts: *pid* and *start* and it can optionally also \r\ncontain a file *name* which, as you might guess, will be used to set application name \r\n(by default application name is the name of the directory) and it can also contain optional file *alert* \r\nthat will be executed if cartboy fails to start the application for several times, more on that later.\r\n\r\n### Quick configuration example\r\nLets look at an example to better illustrate the minimal configuration.\r\nSo lets say we have Nginx installed and we want to set up an autorestarter for it.\r\n\r\nCreate a directory for it \r\n\tmkdir /etc/cartboy/applications/nginx\r\nnow set up the minimal set of scripts for it\r\n\techo \"cat /var/run/nginx.pid\" >  /etc/cartboy/applications/nginx/pid\r\n\techo \"/etc/init.d/nginx start\" >  /etc/cartboy/applications/nginx/start\r\nThat's it. It really is that simple. \r\nIf you want to, you can also optionally provide a better name for the application like so:\r\n\techo \"Nginx web server\" > /etc/cartboy/applications/nginx/name\r\n\r\n### More details on configuration\r\n\r\nLets look at all the application files that you can set up.\r\n\r\n* _pid_ - this script has to return the PID of the application. \r\n\tIf the applications has a pidfile, then you can just __cat__ it like so `cat /var/run/nginx.pid`, \r\n\tif it does not have a pidfile, you can use, for example, __pgrep__ like so `pgrep -f \"nginx: master process\"`. \r\n\tIt does not really matter how you do it as long as your script returns a PID. \r\n* _start_ - this, as you can probably guess, is the script that will be executed in order to start the application. \r\n\tAgain, this can be anything, as long as it gets the job done.\r\n* _name_ - this is just a text file containing the name of the application. It can contain whitespaces. Only the first line of the file will be read.\r\n* _alert_ - this script will be executed if Cartboy fails to start the application for 3 times (can be overriden in the configuration). \r\n\tThis can be quite usefull when the application misbehaves. Depending on what sort of monitoring system you use this script can create some \r\n\tfile that will be read by your monitorins system agent or can, for example, send an email to you. \r\n\tAgain, as with all the previous files, it really is up to the sysadmin to decide if this functionality is necessary and what to do with it.\r\n\r\n## How does it work?\r\n\r\nQuite simple, really. Cartboy is executed from crontab, it checks all the directories under /etc/cartboy/applications \r\nto find any apps that are configured for autorestarting. it does some simple validation just to check if the minimal set of files exists for every application.\r\nFor every application cartboy:\r\n\t\r\n\t* executes the _pid_ file to get the pid\r\n\t* checks the processlist to see if the apllication is running\r\n\t* if it is running then that's it for this application\r\n\t* if the application is not running, cartboy checks if it has already tried starting it up\r\n\t\tby default cartboy will try to start an application for 3 consecutive times, after that a _backoff_ time will kick in, where there will be no more tries to start it for the duration of this time.\r\n\t* if the application fails to start for more than 10 consecutive times, cartboy will increase the backoff time 10 times\r\n\t* if application is started up successfully cartboy resets the failure counter\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}